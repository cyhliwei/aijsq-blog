<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èªæ˜çš„ Vue.js + Thymeleaf æ ‘å½¢èœå•</title>

  <!-- Element UI CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <style>
    [v-cloak] {
      display: none !important;
    }

    /* åŸæœ‰çš„æ‰€æœ‰æ ·å¼ä¿æŒä¸å˜ */
    :root {
      --primary-color: #1890ff;
      --text-color: #333;
      --border-color: #e8e8e8;
      --bg-color: #f8f9fa;
      --card-bg: #fff;
      --hover-bg: #f5f5f5;
      --text-primary: #333;
      --text-secondary: #666;
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --border-radius-sm: 4px;
      --border-radius-md: 8px;
      --border-radius-lg: 12px;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: var(--text-color);
      background-color: #f0f2f5;
      line-height: 1.6;
    }

    /* é¡µé¢å®¹å™¨ */
    .article-page {
      display: flex;
      margin: 0 auto;
      width: 88%;
      justify-content: center;
      padding: var(--spacing-lg);
    }

    .content-layout {
      display: flex;
      gap: calc(var(--spacing-md) * 2);
      transition: all 0.3s ease;
      width: 100%;
    }

    /* ... å…¶ä»–æ‰€æœ‰æ ·å¼ä¿æŒå’Œä¹‹å‰ä¸€æ · ... */

    /* èªæ˜æç¤º */
    .smart-tip {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      z-index: 9999;
      font-size: 14px;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
<!-- èªæ˜çš„æ•°æ®æ³¨å…¥æ–¹å¼ -->
<script th:inline="javascript">
  /*<![CDATA[*/
  // èªæ˜æ–¹æ¡ˆ1ï¼šå…¨å±€å˜é‡ï¼ˆæœ€ç®€å•ç›´æ¥ï¼‰
  window.THYMELEAF_DATA = {
    menus: [[${vo.menus}]],
    // èªæ˜æç¤ºï¼šä½¿ç”¨ ?? è¿ç®—ç¬¦å¤„ç†nullï¼Œä¿è¯å‰ç«¯ä¸æŠ¥é”™
    user: /*[[${vo.user ?? null}]]*/ null,
    settings: /*[[${vo.settings ?? {}}]]*/ {}
  };

  // èªæ˜æ–¹æ¡ˆ2ï¼šè‡ªå®šä¹‰äº‹ä»¶ï¼ˆæ›´è§£è€¦ï¼‰
  document.addEventListener('DOMContentLoaded', function() {
    const thymeleafDataEvent = new CustomEvent('thymeleafDataReady', {
      detail: {
        menus: /*[[${vo.menus}]]*/ null,
        user: /*[[${vo.user ?? null}]]*/ null,
        settings: /*[[${vo.settings ?? {}}]]*/ {}
      }
    });
    document.dispatchEvent(thymeleafDataEvent);
  });

  // èªæ˜æ–¹æ¡ˆ3ï¼šPromiseæ–¹å¼ï¼ˆå¼‚æ­¥å‹å¥½ï¼‰
  window.getThymeleafData = function() {
    return new Promise((resolve) => {
      resolve({
        menus: /*[[${vo.menus}]]*/ [],
        user: /*[[${vo.user ?? null}]]*/ null
      });
    });
  };

  // èªæ˜æ–¹æ¡ˆ4ï¼šå“åº”å¼å¯¹è±¡ï¼ˆVueå‹å¥½ï¼‰
  window.reactiveThymeleafData = {
    get menus() {
      try {
        return [[${vo.menus}]];
      } catch {
        return [];
      }
    },
    get user() {
      try {
        return /*[[${vo.user}]]*/ null;
      } catch {
        return null;
      }
    }
  };
  /*]]>*/
</script>

<!-- Vue.js -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
<!-- Element UI JS -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<div id="app" v-cloak>
  <!-- èªæ˜çš„æç¤ºæ¡† -->
  <div class="smart-tip" v-if="showSmartTip">
    ğŸ’¡ èªæ˜çš„æ–¹æ¡ˆï¼šVue.js + Thymeleaf å®Œç¾é›†æˆï¼
  </div>

  <div class="article-page">
    <div class="content-layout" id="articleBox">
      <!-- å·¦ä¾§å¯¼èˆªæ  -->
      <el-aside class="sidebar" :width="sidebarWidth">
        <div class="sidebar-header">
          <el-tooltip content="çŸ¥è¯†åº“ç›®å½•" placement="right">
            <i class="el-icon-notebook-2"></i>
          </el-tooltip>
          <div class="sidebar-controls">
            <el-tooltip :content="isCollapsed ? 'å±•å¼€ä¾§è¾¹æ ' : 'æŠ˜å ä¾§è¾¹æ '" placement="right">
              <i
                      class="el-icon-s-unfold collapse-icon"
                      @click="toggleSidebar"
              ></i>
            </el-tooltip>
            <el-tooltip v-if="!isCollapsed" content="æ·»åŠ æ–°èœå•" placement="right">
              <i
                      class="el-icon-circle-plus add-icon"
                      @click="addMenu"
              ></i>
            </el-tooltip>
          </div>
        </div>

        <!-- èªæ˜çš„æ ‘å½¢èœå•ç»„ä»¶ -->
        <smart-tree-menu
                :data="menus"
                :collapsed="isCollapsed"
                :default-expand-all="true"
                :highlight-current="true"
                @node-click="handleMenuClick"
                @node-edit="handleEditMenu"
                @node-delete="handleDeleteMenu"
                ref="treeMenu"
        ></smart-tree-menu>

        <!-- æ·»åŠ èœå•æŒ‰é’®ï¼ˆåº•éƒ¨ï¼‰ -->
        <div
                v-if="!isCollapsed"
                class="add-menu-bottom"
                @click="addMenu">
          <i class="el-icon-circle-plus-outline"></i>
          <span>æ·»åŠ æ–°èœå•</span>
        </div>
      </el-aside>

      <!-- ä¸»å†…å®¹åŒº -->
      <main class="article-main">
        <!-- èªæ˜çš„æ•°æ®å±•ç¤º -->
        <header class="article-header">
          <div class="article-title">{{ currentMenu?.title || 'è¯·é€‰æ‹©èœå•' }}</div>

          <div class="article-info">
            <div class="author-info">
              <img :src="currentMenu?.avatar || '/default-avatar.png'" alt="å¤´åƒ" class="author-avatar">
              <div class="author-meta">
                <span class="author-name">{{ currentMenu?.author || 'ç³»ç»Ÿ' }}</span>
                <div class="post-meta">
                  <time class="publish-time">
                    <i class="far fa-calendar-alt"></i>
                    {{ currentMenu?.updateTime || formatDate(new Date()) }}
                  </time>
                  <span class="meta-divider">Â·</span>
                  <span class="category">
                                            <i class="fas fa-folder"></i>
                                            {{ currentMenu?.category || 'æœªåˆ†ç±»' }}
                                        </span>
                </div>
              </div>
            </div>

            <div class="article-stats">
              <div class="stat-item">
                <i class="far fa-eye"></i>
                <span>{{ currentMenu?.views || 0 }} é˜…è¯»</span>
              </div>
              <div class="stat-item">
                <i class="far fa-clock"></i>
                <span>{{ currentMenu?.readTime || 5 }} åˆ†é’Ÿ</span>
              </div>
              <div class="stat-item">
                <i class="far fa-comment"></i>
                <span>{{ currentMenu?.comments || 0 }} è¯„è®º</span>
              </div>
            </div>
          </div>
        </header>

        <!-- æ–‡ç« å†…å®¹ -->
        <article class="article-content" v-html="currentMenu?.content || defaultContent">
        </article>
      </main>

      <!-- ä¾§è¾¹æ ç›®å½• -->
      <aside v-if="showSidebar" class="article-sidebar desktop-only">
        <div class="toc-container">
          <div class="toc-header">
            <div class="title-wrapper">
              <i class="fas fa-list"></i>
              <span>ç›®å½•</span>
            </div>
            <div class="progress-wrapper" :class="{ completed: readProgress === 100 }">
              <i class="fas fa-book-reader"></i>
              <span class="progress-text">{{ readProgress }}%</span>
            </div>
          </div>
          <div class="toc-content">
            <div v-for="(item, index) in tocItems" :key="index"
                 class="toc-item"
                 :class="{
                                    'active': activeHeading === item.id,
                                    [`level-${item.level}`]: true
                                 }"
                 @click="scrollToHeading(item.id)">
              {{ item.text }}
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>
</div>

<script>
  // æ³¨å†Œèªæ˜çš„æ ‘å½¢èœå•ç»„ä»¶
  Vue.component('smart-tree-menu', {
    props: {
      data: {
        type: Array,
        default: () => []
      },
      collapsed: {
        type: Boolean,
        default: false
      },
      defaultExpandAll: {
        type: Boolean,
        default: false
      },
      highlightCurrent: {
        type: Boolean,
        default: true
      },
      currentKey: {
        type: [String, Number],
        default: ''
      }
    },
    data() {
      return {
        currentId: this.currentKey,
        expandedKeys: this.defaultExpandAll ? this.getAllKeys(this.data) : []
      };
    },
    computed: {
      // èªæ˜çš„æ•°æ®å¤„ç†
      processedData() {
        // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œè¿”å›ç©ºæ•°ç»„
        if (!this.data || !Array.isArray(this.data)) {
          return [];
        }

        // èªæ˜å¤„ç†ï¼šå¦‚æœæ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•è§£æJSON
        if (typeof this.data === 'string') {
          try {
            return JSON.parse(this.data);
          } catch (e) {
            console.error('èªæ˜çš„æç¤ºï¼šèœå•æ•°æ®è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼');
            return [];
          }
        }

        return this.data;
      }
    },
    watch: {
      currentKey(val) {
        this.currentId = val;
      },
      defaultExpandAll(val) {
        if (val) {
          this.expandedKeys = this.getAllKeys(this.data);
        }
      }
    },
    methods: {
      // è·å–æ‰€æœ‰èŠ‚ç‚¹key
      getAllKeys(data) {
        const keys = [];
        const traverse = (items) => {
          items.forEach(item => {
            keys.push(item.id);
            if (item.children && item.children.length > 0) {
              traverse(item.children);
            }
          });
        };
        traverse(data);
        return keys;
      },

      // å±•å¼€/æ”¶èµ·èŠ‚ç‚¹
      toggleNode(id) {
        const index = this.expandedKeys.indexOf(id);
        if (index > -1) {
          this.expandedKeys.splice(index, 1);
        } else {
          this.expandedKeys.push(id);
        }
      },

      // ç‚¹å‡»èŠ‚ç‚¹
      handleNodeClick(node) {
        this.currentId = node.id;
        this.$emit('node-click', node);
      },

      // ç¼–è¾‘èŠ‚ç‚¹
      handleNodeEdit(node, e) {
        e.stopPropagation();
        this.$emit('node-edit', node);
      },

      // åˆ é™¤èŠ‚ç‚¹
      handleNodeDelete(node, e) {
        e.stopPropagation();
        this.$emit('node-delete', node);
      },

      // æ¸²æŸ“èŠ‚ç‚¹çš„èªæ˜æ–¹æ³•
      renderNode(item, level = 0) {
        const hasChildren = item.children && item.children.length > 0;
        const isExpanded = this.expandedKeys.includes(item.id);
        const isCurrent = this.highlightCurrent && this.currentId === item.id;

        return `
                        <div class="menu-node" data-id="${item.id}" data-level="${level}">
                            <div class="node-content ${isCurrent ? 'active' : ''}"
                                 style="padding-left: ${level * 20}px"
                                 onclick="this.closest('.smart-tree-menu').__vue__.handleNodeClick(${JSON.stringify(item)})">
                                <span class="expand-icon"
                                      style="visibility: ${hasChildren ? 'visible' : 'hidden'}"
                                      onclick="event.stopPropagation(); this.closest('.smart-tree-menu').__vue__.toggleNode(${item.id})">
                                    ${hasChildren ? (isExpanded ? 'â–¼' : 'â–¶') : 'Â·'}
                                </span>
                                <i class="${item.icon || 'el-icon-document'}"></i>
                                <span class="node-title">${item.title}</span>
                                ${!this.collapsed ? `
                                    <div class="node-actions">
                                        <i class="el-icon-edit edit-icon"
                                           title="ç¼–è¾‘"
                                           onclick="event.stopPropagation(); this.closest('.smart-tree-menu').__vue__.handleNodeEdit(${JSON.stringify(item)}, event)"></i>
                                        <i class="el-icon-delete delete-icon"
                                           title="åˆ é™¤"
                                           onclick="event.stopPropagation(); this.closest('.smart-tree-menu').__vue__.handleNodeDelete(${JSON.stringify(item)}, event)"></i>
                                    </div>
                                ` : ''}
                            </div>
                            ${hasChildren && isExpanded ? `
                                <div class="node-children">
                                    ${item.children.map(child => this.renderNode(child, level + 1)).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
      }
    },
    render(createElement) {
      // èªæ˜çš„æ¸²æŸ“ç­–ç•¥ï¼šä½¿ç”¨templateæˆ–createElement
      if (this.collapsed) {
        return createElement('div', { class: 'collapsed-menu' }, [
          this.processedData.map(item =>
                  createElement('div', {
                    class: 'collapsed-menu-item',
                    on: {
                      click: () => this.handleNodeClick(item)
                    }
                  }, [
                    createElement('i', { class: item.icon || 'el-icon-document' })
                  ])
          )
        ]);
      } else {
        return createElement('div', {
          class: 'smart-tree-menu',
          ref: 'treeContainer'
        }, [
          createElement('div', {
            domProps: {
              innerHTML: this.processedData.map(item => this.renderNode(item)).join('')
            }
          })
        ]);
      }
    },
    mounted() {
      // èªæ˜çš„æŒ‚è½½åå¤„ç†
      if (this.defaultExpandAll) {
        this.expandedKeys = this.getAllKeys(this.processedData);
      }

      // å¦‚æœæœ‰å…³è”çš„å½“å‰èŠ‚ç‚¹ï¼Œè‡ªåŠ¨å±•å¼€å…¶çˆ¶èŠ‚ç‚¹
      if (this.currentId) {
        this.expandToNode(this.currentId);
      }
    }
  });

  // åˆ›å»ºVueå®ä¾‹
  new Vue({
    el: '#app',
    data() {
      return {
        // èªæ˜æ–¹æ¡ˆ1ï¼šç›´æ¥ä»å…¨å±€å˜é‡è·å–Thymeleafæ•°æ®
        menus: window.THYMELEAF_DATA?.menus || [],

        // èªæ˜æ–¹æ¡ˆ2ï¼šä»å“åº”å¼å¯¹è±¡è·å–
        // menus: window.reactiveThymeleafData?.menus || [],

        // æˆ–è€…ä½¿ç”¨Promiseæ–¹å¼ï¼ˆæ›´å¼‚æ­¥å‹å¥½ï¼‰
        // menus: [], // åœ¨created/mountedä¸­è·å–

        isCollapsed: false,
        showSidebar: true,
        currentMenu: null,
        readProgress: 0,
        tocItems: [],
        activeHeading: '',
        sidebarWidth: '260px',
        defaultContent: `
                        <h2>ğŸ’¡ èªæ˜çš„ Vue.js + Thymeleaf é›†æˆæ–¹æ¡ˆ</h2>
                        <p>è¿™ä¸ªé¡µé¢å±•ç¤ºäº†å¦‚ä½•èªæ˜åœ°å°† Thymeleaf åç«¯æ•°æ®æ— ç¼é›†æˆåˆ° Vue.js å‰ç«¯åº”ç”¨ä¸­ã€‚</p>

                        <h3>æ ¸å¿ƒä¼˜åŠ¿ï¼š</h3>
                        <ul>
                            <li><strong>æ•°æ®æ³¨å…¥é›¶å»¶è¿Ÿ</strong>ï¼šThymeleaf åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ç›´æ¥æ³¨å…¥æ•°æ®</li>
                            <li><strong>å®Œå…¨è§£è€¦</strong>ï¼šå‰ç«¯ç»„ä»¶åŒ–ï¼Œåç«¯åªæä¾›æ•°æ®</li>
                            <li><strong>å¼€å‘ä½“éªŒä¼˜ç§€</strong>ï¼šçƒ­é‡è½½ã€å“åº”å¼æ•°æ®ã€ç»„ä»¶å¤ç”¨</li>
                            <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„ API è¯·æ±‚</li>
                        </ul>

                        <h3>ä½¿ç”¨æ–¹å¼ï¼š</h3>
                        <pre><code>
// åç«¯ Thymeleaf Controller
@Controller
public class MenuController {
    @GetMapping("/page")
    public String getPage(Model model) {
        // æŸ¥è¯¢èœå•æ•°æ®
        List<MenuVO> menus = menuService.getMenuTree();

        // èªæ˜çš„æ•°æ®æ³¨å…¥
        model.addAttribute("menus", menus);
        model.addAttribute("user", userService.getCurrentUser());

        return "page";
    }
}

// å‰ç«¯ Thymeleaf æ¨¡æ¿
&lt;script th:inline="javascript"&gt;
    // èªæ˜çš„æ•°æ®æ³¨å…¥ç‚¹
    window.APP_DATA = {
        menus: /*[[${menus}]]*/ [],
        user: /*[[${user}]]*/ null
    };
&lt;/script&gt;
                        </code></pre>

                        <h3>èªæ˜çš„æç¤ºï¼š</h3>
                        <div class="smart-tip" style="position: static; margin: 20px 0;">
                            ğŸ’¡ è®°ä½ï¼š[[${vo.menus}]] æ˜¯ Thymeleaf çš„é»„é‡‘è¯­æ³•ï¼
                        </div>
                    `,
        showSmartTip: true
      };
    },
    computed: {
      // è®¡ç®—å±æ€§ï¼šè·å–å±•å¼€çš„èœå•keys
      expandedMenuKeys() {
        const keys = [];
        const traverse = (items) => {
          items.forEach(item => {
            if (item.children && item.children.length > 0) {
              keys.push(item.id);
              traverse(item.children);
            }
          });
        };
        traverse(this.menus);
        return keys;
      }
    },
    methods: {
      // åˆ‡æ¢ä¾§è¾¹æ 
      toggleSidebar() {
        this.isCollapsed = !this.isCollapsed;
        this.sidebarWidth = this.isCollapsed ? '64px' : '260px';

        // èªæ˜æç¤ºï¼š3ç§’åè‡ªåŠ¨éšè—
        if (this.showSmartTip) {
          setTimeout(() => {
            this.showSmartTip = false;
          }, 3000);
        }
      },

      // å¤„ç†èœå•ç‚¹å‡»
      handleMenuClick(menu) {
        console.log('èªæ˜çš„èœå•ç‚¹å‡»ï¼š', menu);
        this.currentMenu = menu;

        // æ¨¡æ‹ŸåŠ è½½æ–‡ç« å†…å®¹
        this.loadMenuContent(menu);
      },

      // åŠ è½½èœå•å†…å®¹
      async loadMenuContent(menu) {
        // è¿™é‡Œå¯ä»¥è°ƒç”¨APIè·å–å…·ä½“å†…å®¹
        // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
        this.currentMenu = {
          ...menu,
          content: `
                            <h2>${menu.title}</h2>
                            <p>è¿™æ˜¯ ${menu.title} çš„è¯¦ç»†å†…å®¹ï¼Œç”±èªæ˜çš„ Vue + Thymeleaf æ–¹æ¡ˆæ¸²æŸ“ã€‚</p>
                            <p>èœå•IDï¼š${menu.id}</p>
                            <p>åŠ è½½æ—¶é—´ï¼š${new Date().toLocaleTimeString()}</p>

                            <h3>æ•°æ®æ¥æºï¼š</h3>
                            <p>èœå•æ•°æ®é€šè¿‡ Thymeleaf çš„ <code>[[\${vo.menus}]]</code> è¯­æ³•ä»åç«¯æ³¨å…¥åˆ°å‰ç«¯ã€‚</p>

                            <h3>æŠ€æœ¯è¦ç‚¹ï¼š</h3>
                            <ul>
                                <li>åç«¯æ¸²æŸ“æ—¶æ³¨å…¥æ•°æ®ï¼Œé¿å…å‰ç«¯äºŒæ¬¡è¯·æ±‚</li>
                                <li>Vue.js å“åº”å¼é©±åŠ¨è§†å›¾æ›´æ–°</li>
                                <li>Element UI æä¾›ç¾è§‚çš„ç»„ä»¶</li>
                                <li>å®Œå…¨ç»„ä»¶åŒ–ï¼Œæ˜“äºç»´æŠ¤</li>
                            </ul>
                        `,
          author: 'æ™ºèƒ½ç³»ç»Ÿ',
          updateTime: new Date().toLocaleDateString(),
          category: 'æŠ€æœ¯æ–‡æ¡£',
          views: Math.floor(Math.random() * 1000),
          readTime: Math.floor(Math.random() * 10) + 1,
          comments: Math.floor(Math.random() * 100)
        };

        // ç”Ÿæˆç›®å½•
        this.$nextTick(() => {
          this.generateTOC();
        });
      },

      // ç¼–è¾‘èœå•
      handleEditMenu(menu) {
        alert(`èªæ˜çš„ç¼–è¾‘ï¼š${menu.title}\nIDï¼š${menu.id}`);
      },

      // åˆ é™¤èœå•
      handleDeleteMenu(menu) {
        if (confirm(`ç¡®å®šè¦åˆ é™¤ "${menu.title}" å—ï¼Ÿ`)) {
          // è¿™é‡Œå¯ä»¥è°ƒç”¨åˆ é™¤API
          console.log('åˆ é™¤èœå•ï¼š', menu);
        }
      },

      // æ·»åŠ èœå•
      addMenu() {
        alert('æ·»åŠ æ–°èœå•');
      },

      // ç”Ÿæˆç›®å½•
      generateTOC() {
        setTimeout(() => {
          const articleContent = document.querySelector('.article-content');
          if (!articleContent) return;

          const headings = articleContent.querySelectorAll('h2, h3, h4');
          this.tocItems = Array.from(headings).map((heading, index) => {
            const id = `heading-${index}-${Date.now()}`;
            heading.id = id;
            return {
              id,
              text: heading.textContent,
              level: parseInt(heading.tagName.charAt(1))
            };
          });
        }, 100);
      },

      // æ»šåŠ¨åˆ°æ ‡é¢˜
      scrollToHeading(id) {
        const element = document.getElementById(id);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth' });
        }
      },

      // æ ¼å¼åŒ–æ—¥æœŸ
      formatDate(date) {
        return date.toLocaleDateString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit'
        });
      }
    },
    created() {
      // èªæ˜æ–¹æ¡ˆ3ï¼šä½¿ç”¨Promiseæ–¹å¼è·å–æ•°æ®
      if (window.getThymeleafData) {
        window.getThymeleafData().then(data => {
          if (data.menus && (!this.menus || this.menus.length === 0)) {
            this.menus = data.menus;
          }
        });
      }

      // èªæ˜æ–¹æ¡ˆ4ï¼šç›‘å¬è‡ªå®šä¹‰äº‹ä»¶
      document.addEventListener('thymeleafDataReady', (event) => {
        const data = event.detail;
        if (data.menus && (!this.menus || this.menus.length === 0)) {
          this.menus = data.menus;
        }
      });

      // èªæ˜å¤„ç†ï¼šå¦‚æœmenusæ˜¯å­—ç¬¦ä¸²ï¼Œè§£æä¸ºJSON
      if (typeof this.menus === 'string') {
        try {
          this.menus = JSON.parse(this.menus);
        } catch (e) {
          console.error('èªæ˜çš„é”™è¯¯å¤„ç†ï¼šèœå•æ•°æ®è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
          this.menus = this.getDefaultMenus();
        }
      }

      // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®ï¼ˆå¼€å‘æ—¶ç”¨ï¼‰
      if (!this.menus || this.menus.length === 0) {
        this.menus = this.getDefaultMenus();
      }
    },
    mounted() {
      // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªèœå•
      if (this.menus && this.menus.length > 0) {
        this.handleMenuClick(this.menus[0]);
      }

      // æ·»åŠ æ»šåŠ¨ç›‘å¬
      window.addEventListener('scroll', this.handleScroll);

      // èªæ˜æç¤ºè‡ªåŠ¨æ¶ˆå¤±
      setTimeout(() => {
        this.showSmartTip = false;
      }, 5000);
    },
    beforeDestroy() {
      window.removeEventListener('scroll', this.handleScroll);
    }
  });
</script>
</body>
</html>